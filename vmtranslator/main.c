/*! \file
***************************************************************************************************************
file name:					VMTranslator.c
*	\copyright				FourE
*	\brief					main source file
*	\author					Frank Eggink
*	\date	created:			2020-02-23

***************************************************************************************************************
\par	Description
***************************************************************************************************************

	Description

***************************************************************************************************************
\note
***************************************************************************************************************

	note description

***************************************************************************************************************
*/


/*
***************************************************************************************************************
	INCLUDE FILES
***************************************************************************************************************
*/

#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>			// EXIT_FAILURE
#include "filehelper.h"
#include "processhelper.h"

/*
***************************************************************************************************************
	LOCAL DEFINES
***************************************************************************************************************
*/


/*
***************************************************************************************************************
	LOCAL TYPEDEFS
***************************************************************************************************************
*/


/*
***************************************************************************************************************
	LOCAL FUNCTION PROTOTYPES
***************************************************************************************************************
*/

/*
***************************************************************************************************************
	GLOBAL VARS
***************************************************************************************************************
*/


/*
***************************************************************************************************************
	LOCAL VARS
***************************************************************************************************************
*/


/*
***************************************************************************************************************
	IMPLEMENTATION
***************************************************************************************************************
*/

int main(int argc, char *argv[]) {
/*!
***************************************************************************************************************

	\description
		Main program loop

***************************************************************************************************************
*/
	FILE* pFile = NULL;
	FILE* pOutFile = NULL;

	E_inputFileType inputFileType;
	char outputFileName[MAX_FILENAME_LENGTH] = { 0 };

	// argc should be 2 for correct execution
   if (argc != 2) {
   	printf("Usage: %s [VM file/directory]\n", argv[0]);
   	return EXIT_FAILURE;
   }

   inputFileType = GetInputFileType(argv[1]);

   switch(inputFileType) {
   case IFT_SINGLE_VM_FILE:
   	CreateOutputFileName(argv[1], outputFileName, IFT_SINGLE_VM_FILE);
   	break;
   case IFT_DIRECTORY:
   	CreateOutputFileName(argv[1], outputFileName, IFT_DIRECTORY);
   	break;
   default:
   	break;
   }

	// try to open output file
	pOutFile = fopen(outputFileName, "w");
	if (pOutFile == NULL) {
		printf("Error: could not create output file '%s'\n", outputFileName);
		fclose(pFile);
		return EXIT_FAILURE;
	}

	switch(inputFileType) {
	case IFT_SINGLE_VM_FILE:
		ProcessVMFile(argv[1], pOutFile);
		break;
	case IFT_DIRECTORY:
		// only write bootstrap code when there are one or more .vm files inside a directory
		ProcessDirectory(argv[1], pOutFile);
		break;
	default:
		break;
	}

	if (pOutFile != NULL) {
		fclose(pOutFile);
		pOutFile = NULL;
	}
	return EXIT_SUCCESS;
}
/*
***************************************************************************************************************
	End main
***************************************************************************************************************
*/
